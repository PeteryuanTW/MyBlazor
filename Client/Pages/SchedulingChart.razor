@page "/schedulingChart"
@using MyBlazor.Shared.DataClass
@inject StateContainer stateContainer
<MyGanttChart allMachineStatus="@machineData" dateTimeID ="@dateTimeID"  jobs = "@jobs" bestDueTime="@bestDueTime"></MyGanttChart>

@code {
	public List<MachineData> machineData = new List<MachineData>();
	private DateTime dateTimeID;
	private List<List<Job>> jobs = new();
	private TimeSpan bestDueTime = TimeSpan.Zero;

	protected override Task OnInitializedAsync()
	{
		machineData = stateContainer.GetMachineData();
		if (stateContainer.GetCurrentScheduling() != null)
		{
			dateTimeID = stateContainer.GetCurrentScheduling().dataTimeID;
		    jobs = stateContainer.GetCurrentScheduling().jobs;
		    bestDueTime = stateContainer.GetCurrentScheduling().dueTime;
		}
		
		stateContainer.OnCurrentSchedulingChange += GetNewScheduling;
		return base.OnInitializedAsync();
	}
	public void Dispose()
	{
		stateContainer.OnCurrentSchedulingChange -= GetNewScheduling;
	}

	private void GetNewScheduling(SchedulingHistory newScheduling)
	{
		dateTimeID = newScheduling.dataTimeID;
		jobs = newScheduling.jobs;
		bestDueTime = newScheduling.dueTime;
		StateHasChanged();
	}
}